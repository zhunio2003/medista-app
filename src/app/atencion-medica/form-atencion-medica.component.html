<div class="scroll-container">
    <div class="container d-flex justify-content-center mt-3">
        <h2>Ingreso de Atención Medica</h2>
    </div>



    <form ngNativeValidate (ngSubmit)="create()" class="margin">


        <div class="mx-4">
            <h3 for="motivo">Datos de Filiación</h3>
        </div>

        <fieldset class="container-datos form-grid mx-4">
            <div class="input-group ">
                <div class="search-group">
                    <input type="text" id="cedula" name="cedula" placeholder="Cédula" [(ngModel)]="cedulaBusqueda">
                    <button type="button" class="search-button" (click)="buscar()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="input-container">
                <input type="text" id="profesion" name="profesion" placeholder="profesion" disabled
                    [value]="pacienteEncontrado?.profesion || ''">
            </div>
            <div class="input-container">
                <input type="text" id="nombre" name="nombre" placeholder="Nombre" disabled
                    [value]="pacienteEncontrado?.nombre || ''" [(ngModel)]="atencionMedica.fichaMedica.paciente">
            </div>
            <div class="input-container">
                <input type="text" id="apellido" name="apellido" placeholder="Apellido" disabled
                    [value]="pacienteEncontrado?.apellido || ''">
            </div>
            <div class="input-container">
                <input type="text" id="carrera" name="carrera" placeholder="Carrera" disabled
                    [value]="pacienteEncontrado?.carrera || ''">
            </div>
            <div class="input-container">
                <input type="text" id="direccion" name="direccion" placeholder="Dirección" disabled
                    [value]="pacienteEncontrado?.direccion || ''">
            </div>
            <div class="input-container">
                <input type="text" id="barrio" name="barrio" placeholder="Barrio" disabled
                    [value]="pacienteEncontrado?.barrio || ''">
            </div>
            <div class="input-container">
                <input type="text" id="parroquia" name="parroquia" placeholder="Parroquia" disabled
                    [value]="pacienteEncontrado?.parroquia || ''">
            </div>
            <div class="input-container">
                <input type="text" id="canton" name="canton" placeholder="Cantón" disabled
                    [value]="pacienteEncontrado?.canton || ''">
            </div>
            <div class="input-container">
                <input type="text" id="provincia" name="provincia" placeholder="Provincia" disabled
                    [value]="pacienteEncontrado?.provincia || ''">
            </div>
            <div class="input-container">
                <input type="text" id="telefono" name="telefono" placeholder="Teléfono" disabled
                    [value]="pacienteEncontrado?.telefono || ''">
            </div>
            <div class="input-container">
                <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" disabled
                    [value]="pacienteEncontrado?.fechaNacimiento || ''">
            </div>
            <div class="input-container">
                <input type="text" id="lugar" name="lugar" placeholder="Lugar" disabled
                    [value]="pacienteEncontrado?.lugar || ''">
            </div>
            <div class="input-container">
                <input type="text" id="pais" name="pais" placeholder="País" disabled
                    [value]="pacienteEncontrado?.pais || ''">
            </div>
            <div class="input-container">
                <input type="number" id="edad" name="edad" placeholder="Edad" disabled>
            </div>
            <div class="input-container">
                <input type="text" id="genero" name="genero" placeholder="Género" disabled
                    [value]="pacienteEncontrado?.genero || ''">
            </div>
            <div class="input-container">
                <input type="text" id="estado_civil" name="estado_civil" placeholder="Estado Civil" disabled
                    [value]="pacienteEncontrado?.estadoCivil || ''">
            </div>
            <div class="input-container">
                <input type="text" id="tipo_sangre" name="tipo_sangre" placeholder="Tipo de Sangre" disabled
                    [value]="pacienteEncontrado?.tipoSangre || ''">
            </div>
            <div class="input-container">
                <input type="text" id="ciclo" name="ciclo" placeholder="Ciclo" disabled
                    [value]="pacienteEncontrado?.ciclo || ''">
            </div>

        </fieldset>


        <!-- SECCIÓN: Emergencias Obstétricas -->
<div class="mx-4 mt-4" *ngIf="esMujer()">
    <h3>Emergencias Obstétricas</h3>
</div>

<fieldset *ngIf="esMujer()" class="container-emergencia-obstetrica mx-4">
    <div class="obstetrics-table-container">
        <table class="obstetrics-table">
            <tbody>
                <tr>
                    <td class="obstetrics-label">Menarca:</td>
                    <td class="obstetrics-input">
                        <input type="number" id="menarca" name="menarca" 
                            [value]="historialGinecologico?.menarca || ''" disabled>
                    </td>
                    <td class="obstetrics-label">Ritmo Menstrual:</td>
                    <td class="obstetrics-input">
                        <input type="text" id="ritmo_menstrual" name="ritmo_menstrual" 
                            [value]="historialGinecologico?.ritmoMenstrual || ''" disabled>
                    </td>
                    <td class="obstetrics-label">Ciclos:</td>
                    <td class="obstetrics-input">
                        <input type="number" id="ciclos" name="ciclos" 
                            [value]="historialGinecologico?.ciclos || ''" disabled>
                    </td>
                    <td class="obstetrics-label">FUM:</td>
                    <td class="obstetrics-input obstetrics-date">
                        <span class="date-labels">D___ M___ A___</span>
                        <input type="date" id="fum" name="fum" 
                            [value]="atencionMedica.embarazoActual.getFumFormatted()" 
                            (change)="onFumChange($event)">
                    </td>
                    <td class="obstetrics-checkbox-section">
                        <div class="checkbox-group">
                            <span class="checkbox-title">Marque según aplique:</span>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dismenorrea" name="dismenorrea"
                                    [checked]="historialGinecologico?.dismenorrea || false" disabled>
                                <label for="dismenorrea">Dismenorrea</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mastodinia" name="mastodinia"
                                    [checked]="historialGinecologico?.mastodinia || false" disabled>
                                <label for="mastodinia">Mastodinia</label>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="obstetrics-label">IVSA:</td>
                    <td class="obstetrics-input">
                        <input type="number" id="ivsa" name="ivsa" 
                            [value]="historialGinecologico?.ivsa || ''" disabled>
                    </td>
                    <td class="obstetrics-label">N° Parejas sexuales:</td>
                    <td class="obstetrics-input">
                        <input type="number" id="numero_parejas_sexuales" name="numero_parejas_sexuales" 
                            [value]="historialGinecologico?.numeroParejaSexuales || ''" disabled>
                    </td>
                    <td colspan="2" class="obstetrics-gapc-section">
                        <div class="gapc-container">
                            <span class="gapc-label">G___A___P___C___</span>
                            <div class="gapc-inputs">
                                <div class="gapc-input-group">
                                    <label>G:</label>
                                    <input type="number" id="gestas" name="gestas" 
                                        [value]="historialGinecologico?.gestas || ''" disabled>
                                </div>
                                <div class="gapc-input-group">
                                    <label>A:</label>
                                    <input type="number" id="abortos" name="abortos" 
                                        [value]="historialGinecologico?.abortos || ''" disabled>
                                </div>
                                <div class="gapc-input-group">
                                    <label>P:</label>
                                    <input type="number" id="partos" name="partos" 
                                        [value]="historialGinecologico?.partos || ''" disabled>
                                </div>
                                <div class="gapc-input-group">
                                    <label>C:</label>
                                    <input type="number" id="cesareas" name="cesareas" 
                                        [value]="historialGinecologico?.cesareas || ''" disabled>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td colspan="2"></td>
                </tr>
                <tr>
                    <td class="obstetrics-label">¿Está embarazada?:</td>
                    <td class="obstetrics-input">
                        <input type="checkbox" id="isEmbarazada" name="isEmbarazada"
                            [(ngModel)]="atencionMedica.embarazoActual.isEmbarazada"
                            (change)="onEmbarazadaChange()">
                    </td>
                    <td class="obstetrics-label">FPP:</td>
                    <td class="obstetrics-input obstetrics-date">
                        <span class="date-labels">D___ M___ A___ SG___</span>
                        <input type="date" id="fpp" name="fpp" 
                            [value]="atencionMedica.embarazoActual.getFppFormatted()"
                            (change)="onFppChange($event)"
                            *ngIf="atencionMedica.embarazoActual.isEmbarazada">
                    </td>
                    <td class="obstetrics-label">Controles:</td>
                    <td class="obstetrics-input">
                        <input type="number" id="controles" name="controles" 
                            [(ngModel)]="atencionMedica.embarazoActual.controles"
                            *ngIf="atencionMedica.embarazoActual.isEmbarazada"
                            placeholder="Número de controles">
                    </td>
                    <td class="obstetrics-label">Inmunizaciones:</td>
                    <td class="obstetrics-input">
                        <input type="text" id="inmunizaciones" name="inmunizaciones" 
                            [(ngModel)]="atencionMedica.embarazoActual.inmunizaciones"
                            *ngIf="atencionMedica.embarazoActual.isEmbarazada"
                            placeholder="Inmunizaciones recibidas">
                    </td>
                    <td class="obstetrics-input" *ngIf="atencionMedica.embarazoActual.isEmbarazada">
                        <div class="semanas-gestacion">
                            <label>Semanas:</label>
                            <span>{{atencionMedica.embarazoActual.semanasGestacion || 0}} SG</span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="9" class="obstetrics-description">
                        <label for="descripcion_embarazo">Descripción / Observaciones:</label>
                        <textarea id="descripcion_embarazo" name="descripcion_embarazo" 
                            [(ngModel)]="atencionMedica.embarazoActual.descripcion"
                            placeholder="Observaciones sobre el embarazo actual..." rows="3"></textarea>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</fieldset>


        <div class="mx-4 mt-4">
            <h3 for="motivo">Motivo Consulta:</h3>
        </div>

        <fieldset class="textarea-container mx-4">
            <textarea id="motivAteo" name="motivoAte" placeholder="Escribe tus observaciones aquí..." rows="4" cols="50"
                [(ngModel)]="atencionMedica.motivoAte"></textarea>
        </fieldset>


        <div class="mx-4 mt-4">
            <h3 for="motivo">Antecedentes familiares y personales</h3>
        </div>

        <fieldset class="textarea-container mx-4">
            <div class="table-responsive">
                <table class="table table-bordered table-striped ">
                    <thead>
                        <tr>
                            <th>Alergias</th>
                            <th>Clinica</th>
                            <th>Ginecólogico</th>
                            <th>Traumatológico</th>
                            <th>Quirúcgico</th>
                            <th>Farmacológico</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="center-table">
                            <td>{{ fichaMedica.antecedenteFamiliar.alergiaAnt ?
                                fichaMedica.antecedenteFamiliar.descripcionAlergiaAnt : 'NO APLICA' }}</td>
                            <td>{{ fichaMedica.antecedenteFamiliar.clinicoAnt ?
                                fichaMedica.antecedenteFamiliar.descripcionClinicoAnt : 'NO APLICA' }}</td>
                            <td>{{ fichaMedica.antecedenteFamiliar.ginecologoAnt ?
                                fichaMedica.antecedenteFamiliar.descripcionGinecologoAnt : 'NO APLICA' }}</td>
                            <td>{{ fichaMedica.antecedenteFamiliar.traumatologicoAnt ?
                                fichaMedica.antecedenteFamiliar.descripcionTraumatologicoAnt : 'NO APLICA' }}</td>
                            <td>{{ fichaMedica.antecedenteFamiliar.quirurgicoAnt ?
                                fichaMedica.antecedenteFamiliar.descripcionQuirurgicoAnt : 'NO APLICA' }}</td>
                            <td>{{ fichaMedica.antecedenteFamiliar.farmacologicoAnt ?
                                fichaMedica.antecedenteFamiliar.descripcionFarmacologicoAnt : 'NO APLICA' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </fieldset>

        <div class="mx-4 mt-4">
            <h3 for="motivo">Enfermedad Actual</h3>
        </div>

        <fieldset class="textarea-container mx-4">
            <textarea id="enfermedad" name="enfermedad" placeholder="Escribe tus observaciones aquí..." rows="4"
                cols="50" [(ngModel)]="atencionMedica.enfermedadActualAte"></textarea>
        </fieldset>

        <div class="mx-4 mt-4">
            <h3 for="signos">Signos Vitales</h3>
        </div>
        <fieldset class="container-signos form-grid mx-4">
            <div class="input-container">
                <label for="pa">PA:</label>
                <input type="number" id="pa" name="pa" placeholder="PA:"
                    [(ngModel)]="atencionMedica.signosVitales.presionArterial">
            </div>

            <div class="input-container">
                <label for="peso">PESO</label>
                <input type="number" id="peso" name="peso" placeholder="PESO:"
                    [(ngModel)]="atencionMedica.signosVitales.peso">
            </div>

            <div class="input-container">
                <label for="talla">TALLA:</label>
                <input type="number" id="talla" name="talla" placeholder="TALLA:"
                    [(ngModel)]="atencionMedica.signosVitales.talla">
            </div>

            <div class="input-container">
                <label for="imc">IMC:</label>
                <input type="number" id="imc" name="imc" placeholder="IMC:"
                    [(ngModel)]="atencionMedica.signosVitales.imc">
            </div>

            <div class="input-container">
                <label for="fc">FC:</label>
                <input type="number" id="fc" name="fc" placeholder="FC:"
                    [(ngModel)]="atencionMedica.signosVitales.frecuenciaCardiaca">
            </div>

            <div class="input-container">
                <label for="fr">FR:</label>
                <input type="number" id="fr" name="fr" placeholder="FR:"
                    [(ngModel)]="atencionMedica.signosVitales.frecuenciaRespiratoria">
            </div>

            <div class="input-container">
                <label for="t">T°:</label>
                <input type="number" id="t" name="t" placeholder="T°:"
                    [(ngModel)]="atencionMedica.signosVitales.temperatura">
            </div>

            <div class="input-container">
                <label for="sat">Sat.O2:</label>
                <input type="number" id="sat" name="sat" placeholder="SAT.O2:"
                    [(ngModel)]="atencionMedica.signosVitales.saturacionOxigeno">
            </div>

            <div class="input-container">
                <label for="ocular">OCULAR:</label>
                <input type="number" id="ocular" name="ocular" placeholder="OCULAR:" min="0" max="5"
                    [(ngModel)]="atencionMedica.signosVitales.glasgowOcular" (ngModelChange)="updateTotalGlasgow()">
            </div>

            <div class="input-container">
                <label for="verbal">VERBAL:</label>
                <input type="number" id="verbal" name="verbal" placeholder="VERBAL:" min="0" max="5"
                    [(ngModel)]="atencionMedica.signosVitales.glasgowVerbal" (ngModelChange)="updateTotalGlasgow()">
            </div>

            <div class="input-container">
                <label for="motora">MOTORA:</label>
                <input type="number" id="motora" name="motora" placeholder="MOTORA:" min="0" max="6"
                    [(ngModel)]="atencionMedica.signosVitales.glasgowMotora" (ngModelChange)="updateTotalGlasgow()">
            </div>

            <div class="input-container">
                <label for="total">TOTAL:</label>
                <input type="number" id="total" name="total" placeholder="TOTAL:"
                    [(ngModel)]="atencionMedica.signosVitales.glasgowTotal" disabled>
            </div>

            <div class="input-container">
                <label for="capilar">LLEN.CAPILAR:</label>
                <input type="number" id="capilar" name="capilar" placeholder="LLEN. CAPILAR:"
                    [(ngModel)]="atencionMedica.signosVitales.llenadoCapilar">
            </div>

            <div class="input-container">
                <label for="pupilar">R.PUPILAR:</label>
                <input type="number" id="pupilar" name="pupilar" placeholder="R.PUPILAR:"
                    [(ngModel)]="atencionMedica.signosVitales.reaccionPupilar">
            </div>
        </fieldset>



        <div class="mx-4 mt-4">
            <h3 for="examenfisico">Exámen Físico</h3>
        </div>
        <fieldset class="container-fisico form-grid-fisico mx-4">
            <div class="form-row">
                <label for="piel">PIEL Y FANERAS</label>
                <input type="text" id="piel" name="piel" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.pielFaneras">
            </div>

            <div class="form-row">
                <label for="cabeza">CABEZA</label>
                <input type="text" id="cabeza" name="cabeza" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.cabeza">
            </div>

            <div class="form-row">
                <label for="cuello">CUELLO</label>
                <input type="text" id="cuello" name="cuello" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.cuello">
            </div>

            <div class="form-row">
                <label for="torax">TÓRAX</label>
                <input type="text" id="torax" name="torax" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.torax">
            </div>

            <div class="form-row">
                <label for="corazon">CORAZÓN</label>
                <input type="text" id="corazon" name="corazon" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.corazon">
            </div>

            <div class="form-row">
                <label for="abdomen">ABDOMEN</label>
                <input type="text" id="abdomen" name="abdomen" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.abdomen">
            </div>

            <div class="form-row">
                <label for="inguinal">R. INGUINAL</label>
                <input type="text" id="inguinal" name="inguinal" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.regionInguinal">
            </div>

            <div class="form-row">
                <label for="superiores">M.SUPERIORES</label>
                <input type="text" id="superiores" name="superiores" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.miembrosSuperiores">
            </div>

            <div class="form-row">
                <label for="inferiores">M.INFERIORES</label>
                <input type="text" id="inferiores" name="inferiores" placeholder="Escribe aquí..."
                    [(ngModel)]="atencionMedica.examenFisico.miembrosInferiores">
            </div>
        </fieldset>



        <div class="mx-4 mt-4">
            <h3 for="examenes">Exámenes Complementarios</h3>
        </div>

        <div class="diagnostico-container mx-4">
            <table class="diagnostico-table">
                <thead>
                    <tr>
                        <th class="w-75" style="background-color:#63e77b;">Descripción</th>
                        <th style="background-color:#63e77b;">Aplicable</th>
                        <th style="background-color:#63e77b;">Documentos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of atencionMedica.examenesComplementarios; let i = index">
                        <td>
                            <textarea [(ngModel)]="atencionMedica.examenesComplementarios[i].nombre"
                                name="tituloExa{{i}}" placeholder="Ingrese el diagnóstico"></textarea>
                        </td>
                        <td>
                            <input type="checkbox" id="no_aplicable{{i}}" name="aplicaExa{{i}}"
                                [(ngModel)]="atencionMedica.examenesComplementarios[i].aplica">
                        </td>
                        <td>
                            <div class="custom-file-upload">
                                <input type="file" id="documentoExa{{i}}" name="documentoExa{{i}}"
                                    (change)="onFileChange($event, i)" class="file-input">

                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button type="button" (click)="addExamenComplementario()" class="botonCrearFila">Agregar examen
                complementario</button>
        </div>

        <div class="mx-4">
            <h3 for="diagnostico">Diagnóstico:</h3>
        </div>

        <div class="diagnostico-container">
            <table class="diagnostico-table">
                <thead>
                    <tr>
                        <th class="w-50">DIAGNÓSTICO INICIAL</th>
                        <th class="w-25">Enfermedad</th>
                        <th>CIE-10</th>
                        <th>Presuntivo</th>
                        <th>Definitivo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of atencionMedica.diagnosticos; let i = index">
                        <td class="w-50">
                            <textarea [(ngModel)]="item.descripcion" placeholder="Ingrese el diagnóstico"
                                name="diagnostico{{i}}">
                        </textarea>
                        </td>
                        <td class="w-25">
                            <div class="autocomplete-container">
                                <input type="text" [(ngModel)]="item.enfermedad.nombre"
                                    placeholder="Escribe para buscar" (input)="filterEnfermedades($event, i)"
                                    name="search{{i}}">
                                <div class="autocomplete-items"
                                    *ngIf="filteredEnfermedades[i] && filteredEnfermedades[i].length > 0">
                                    <div *ngFor="let enfermedad of filteredEnfermedades[i]"
                                        (click)="selectEnfermedad(enfermedad, i)">
                                        {{ enfermedad.nombreEnf }}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            {{ item.enfermedad.codigo }}
                        </td>
                        <td>
                            <input type="radio" id="presuntivo{{i}}" name="diagnosticoTipo{{i}}"
                                [(ngModel)]="item.estado" [value]="false">
                        </td>
                        <td>
                            <input type="radio" id="definitivo{{i}}" name="diagnosticoTipo{{i}}"
                                [(ngModel)]="item.estado" [value]="true">
                        </td>
                    </tr>
                </tbody>
            </table>
            <button type="button" (click)="addDiagnostico()" class="botonCrearFila">Agregar Diagnóstico</button>
        </div>



        <div class="textarea-container mx-4">
            <h3 for="tratamiento">Tratamiento</h3>
            <textarea id="tratamiento" name="tratamiento" placeholder="Escribe tus observaciones aquí..." rows="4"
                cols="50" [(ngModel)]="atencionMedica.tratamientoAte"></textarea>
        </div>

        <div class="form-footer">
            <button class="btn btn-success " role="button">Guardar</button>
            <button type="button" name="button" class="btn btn-danger " (click)="cancelar()">Cancelar</button>
        </div>

    </form>

</div>